import{$a as a,Ta as q,Va as d,Wa as y,Xa as v,Ya as E,Za as i,_a as D,bb as h,d as g,db as l,eb as S,fb as f,gb as u,v as b,y as P}from"./chunk-NEVV3RH6.js";import{a as I,e as c}from"./chunk-5FZOKLP6.js";var G=(()=>{class m{constructor(e){this.firestore=e,this.shipments$=new g([]),this.shipmentsObservable=this.shipments$.asObservable()}submitShipment(e,t){return c(this,null,function*(){try{let r=i(this.firestore,t),o=e.DispatchedDate,s=l(r,u("DispatchedDate","==",o)),n=yield h(s);if(!n.empty){let p=n.docs[0],w=p.data(),F=[...w.shipmentItemsDetails,...e.shipmentItemsDetails];return yield f(p.ref,{shipmentItemsDetails:F,shipmentGrandTotal:w.shipmentGrandTotal+e.shipmentGrandTotal}),p.id}return(yield y(r,I({},e))).id}catch(r){throw console.error("Error adding shipment:",r),r}})}getAllShipmentDetails(e){let t=e==="Madurai Pandiyas"?"Madurai Pandiyas":"Madurai Pandiyas Elite",r=i(this.firestore,t);return d(r,{idField:"id"})}setShipments(e){this.shipments$.next([...e])}getShipments(){return[...this.shipments$.value]}addItem(e,t="Items"){return c(this,null,function*(){try{let r=i(this.firestore,t);return(yield y(r,e)).id}catch(r){throw console.error("Error adding item:",r),r}})}getAllItemsDetails(e){let t=i(this.firestore,e);return d(t,{idField:"id"})}deleteShipmentById(e,t){let r=a(this.firestore,e,t);return D(r)}updateItemPrice(e,t){let r=i(this.firestore,"Items"),o=l(r,u("itemName","==",e));h(o).then(s=>{s.empty||s.forEach(n=>c(this,null,function*(){let R=a(this.firestore,"Items",n.id);yield f(R,{unitPrice:t})}))}).catch(s=>{console.error("Error updating item price:",s)})}deleteItem(e){return c(this,null,function*(){try{let t=i(this.firestore,"Items"),r=l(t,u("itemName","==",e)),o=yield h(r);o.empty?console.log("No item found with that name."):o.forEach(s=>c(this,null,function*(){let n=a(this.firestore,"Items",s.id);yield D(n),console.log(`Deleted item: ${e}`)}))}catch(t){console.error("Error deleting item:",t)}})}submitItemRequest(e,t){let r=a(this.firestore,"Purchase List",t);return S(r,{items:E(...e.items),RequestedOn:e.RequestedOn},{merge:!0})}getPurchaseItems(e){let t=i(this.firestore,e);return d(t,{idField:"id"})}deletePurchasedItems(e,t){let r=a(this.firestore,"Purchase List",e);return f(r,{items:v(...t)})}static{this.\u0275fac=function(t){return new(t||m)(P(q))}}static{this.\u0275prov=b({token:m,factory:m.\u0275fac,providedIn:"root"})}}return m})();export{G as a};
