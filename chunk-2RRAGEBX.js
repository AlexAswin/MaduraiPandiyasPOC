import{$a as c,Ta as q,Va as h,Wa as v,Xa as S,Ya as E,Za as o,_a as D,bb as d,d as w,db as l,eb as F,fb as f,gb as u,v as b,y as P}from"./chunk-I7XMEI44.js";import{a as I,b as R,e as m}from"./chunk-5FZOKLP6.js";var G=(()=>{class a{constructor(e){this.firestore=e,this.shipments$=new w([]),this.shipmentsObservable=this.shipments$.asObservable()}submitShipment(e,t){return m(this,null,function*(){try{let s=o(this.firestore,t),r=new Date(e.DispatchedTime).toDateString(),i=l(s,u("DispatchedDate","==",r)),n=yield d(i);if(!n.empty){let p=n.docs[0],g=p.data(),$=[...g.shipmentItemsDetails,...e.shipmentItemsDetails];return yield f(p.ref,{shipmentItemsDetails:$,shipmentGrandTotal:g.shipmentGrandTotal+e.shipmentGrandTotal}),p.id}return(yield v(s,R(I({},e),{DispatchedDate:r}))).id}catch(s){throw console.error("Error adding shipment:",s),s}})}getAllShipmentDetails(e){let t=e==="Madurai Pandiyas"?"Madurai Pandiyas":"Madurai Pandiyas Elite",s=o(this.firestore,t);return h(s,{idField:"id"})}setShipments(e){this.shipments$.next([...e])}getShipments(){return[...this.shipments$.value]}getAllItemsDetails(e){let t=o(this.firestore,e);return h(t,{idField:"id"})}deleteShipmentById(e,t){let s=c(this.firestore,e,t);return D(s)}updateItemPrice(e,t){let s=o(this.firestore,"Items"),r=l(s,u("itemName","==",e));d(r).then(i=>{i.empty||i.forEach(n=>m(this,null,function*(){let y=c(this.firestore,"Items",n.id);yield f(y,{unitPrice:t})}))}).catch(i=>{console.error("Error updating item price:",i)})}deleteItem(e){return m(this,null,function*(){try{let t=o(this.firestore,"Items"),s=l(t,u("itemName","==",e)),r=yield d(s);r.empty?console.log("No item found with that name."):r.forEach(i=>m(this,null,function*(){let n=c(this.firestore,"Items",i.id);yield D(n),console.log(`Deleted item: ${e}`)}))}catch(t){console.error("Error deleting item:",t)}})}submitItemRequest(e,t){let s=c(this.firestore,"Purchase List",t);return F(s,{items:E(...e.items),RequestedOn:e.RequestedOn},{merge:!0})}getPurchaseItems(e){let t=o(this.firestore,e);return h(t,{idField:"id"})}deletePurchasedItems(e,t){let s=c(this.firestore,"Purchase List",e);return f(s,{items:S(...t)})}static{this.\u0275fac=function(t){return new(t||a)(P(q))}}static{this.\u0275prov=b({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();export{G as a};
